# Relative path to the ALREADY-COMPILED rpi-rgb-led-matrix code:
RGB_LIB_PATH=../../rpi-rgb-led-matrix
RGB_INCDIR=$(RGB_LIB_PATH)/include
RGB_LIBDIR=$(RGB_LIB_PATH)/lib
RGB_LIBRARY_NAME=rgbmatrix
RGB_LIBRARY=$(RGB_LIBDIR)/lib$(RGB_LIBRARY_NAME).a

# Relative path to microbit-serial code
MICROBIT_SERIAL_LIB_PATH=../../microbit-serial
MICROBIT_SERIAL_INCDIR=$(MICROBIT_SERIAL_LIB_PATH)/include
MICROBIT_SERIAL_LIBRARY=$(MICROBIT_SERIAL_LIB_PATH)/lib/microbit-serial.o

# Relative path to the Adafruit_PixelDust library source:
PIXELDUST_PATH=..

#CXXFLAGS=-Wall -Ofast -fomit-frame-pointer -funroll-loops -s -I$(RGB_INCDIR) -I$(PIXELDUST_PATH)
CXXFLAGS=-Wall -s -I$(RGB_INCDIR) -I$(PIXELDUST_PATH) -I$(MICROBIT_SERIAL_INCDIR)
LDFLAGS=-L$(RGB_LIBDIR) -l$(RGB_LIBRARY_NAME) -lrt -lm -lpthread
LIBS=Adafruit_PixelDust.o $(RGB_LIBRARY) $(MICROBIT_SERIAL_LIBRARY)
EXECS=demo1-snow demo2-hourglass demo3-logo cube

all: $(EXECS)

# Compile PixelDust library into current directory
Adafruit_PixelDust.o: $(PIXELDUST_PATH)/Adafruit_PixelDust.cpp $(PIXELDUST_PATH)/Adafruit_PixelDust.h
	$(CXX) $(CXXFLAGS) -c $<

demo1-snow: demo1-snow.cpp $(LIBS)
	$(CXX) $(CXXFLAGS) $< $(LDFLAGS) $(LIBS) -o $@
	strip $@

demo2-hourglass: demo2-hourglass.cpp $(LIBS)
	$(CXX) $(CXXFLAGS) $< $(LDFLAGS) $(LIBS) -o $@
	strip $@

demo3-logo: demo3-logo.cpp logo.h $(LIBS)
	$(CXX) $(CXXFLAGS) $< $(LDFLAGS) $(LIBS) -o $@
	strip $@

cube: cube.cpp $(LIBS)
	$(CXX) $(CXXFLAGS) $< $(LDFLAGS) $(LIBS) -o $@
	strip $@

clean:
	rm -f $(EXECS) *.o
